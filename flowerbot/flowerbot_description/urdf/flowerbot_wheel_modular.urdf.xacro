<?xml version="1.0" ?>
<robot name="flowerbot_wheel_modular" 
    xmlns:xacro="http://ros.org/wiki/xacro">
    <xacro:include filename="$(find flowerbot_description)/urdf/flowerbot_library.urdf.xacro"/>
    <xacro:include filename="$(find flowerbot_description)/urdf/flowerbot_wheel_modular.gazebo.xacro"/>
    <xacro:macro name="wheel_modular" params="root_link suffix wheel_type steering_start_angle *root_link_origin">

        <gazebo_material link_name="${suffix}_steering_link" color="Orange" mu1="0" mu2="0"/>
        <gazebo_material link_name="${suffix}_steering_arm_link" color="Orange" mu1="0" mu2="0"/>
        <gazebo_material link_name="${suffix}_wheel_link" color="Black" mu1="1" mu2="1"/>

        <link name="${suffix}_steering_arm_link">
            <inertial>
                <origin xyz="-0.000033 -0.059005  -0.107760" rpy="0 0 0" />
                <mass value="0.64615" />
                <inertia ixx="0.0138" ixy="0.0" ixz="0.0" iyy="0.011" iyz="0.0048" izz="0.0031" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://flowerbot_description/meshes/steering_arm_link.STL" />
                </geometry>
                <material name="material_orange"/>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://flowerbot_description/meshes/steering_arm_link.STL" />
                </geometry>
            </collision>
        </link>


        <xacro:if value="${wheel_type == WHEEL_TYPE_DRIVING_STEERING}">
            <link name="${suffix}_steering_link">
                <inertial>
                    <origin xyz="0.004891 0 0.053105" rpy="0 0 0" />
                    <mass value="0.49153" />
                    <inertia ixx="0.00627" ixy="0.00108" ixz="0.00146" iyy="0.00459" iyz="0.0026" izz="0.00328" />
                </inertial>
                <visual>
                    <origin xyz="0 0 0" rpy="0 0 0" />
                    <geometry>
                        <mesh filename="package://flowerbot_description/meshes/steering_link.STL" />
                    </geometry>
                    <material name="material_orange"/>
                </visual>
                <collision>
                    <origin xyz="0 0 0" rpy="0 0 0" />
                    <geometry>
                        <mesh filename="package://flowerbot_description/meshes/steering_link.STL" />
                    </geometry>
                </collision>
            </link>

            <joint name="${suffix}_steering_joint" type="revolute">
                <origin xyz="0 0 -0.001" rpy="0 0 ${steering_start_angle}" />
                <parent link="${suffix}_steering_link" />
                <child link="${suffix}_steering_arm_link" />
                <axis xyz="0 0 1" />
                <limit lower="${-M_PI/2}" upper="${M_PI/2}" effort="0" velocity="1" />
                <safety_controller k_velocity="0" />
            </joint>
            <steering_control joint_name="${suffix}_steering_joint"/>
        </xacro:if>


        <joint name="${suffix}_wheel_modular_joint" type="fixed">
            <xacro:insert_block name="root_link_origin" />
            <parent link="${root_link}" />
            <xacro:if value="${wheel_type == WHEEL_TYPE_DRIVING_STEERING}">
                <child link="${suffix}_steering_link" />
            </xacro:if>
            <xacro:if value="${wheel_type != WHEEL_TYPE_DRIVING_STEERING}">
                <child link="${suffix}_steering_arm_link" />
            </xacro:if>
        </joint>

        <link name="${suffix}_wheel_link">
            <inertial>
                <origin xyz="0 0 0.0" rpy="0 0 0" />
                <mass value="2.96" />
                <inertia ixx="0.015686" ixy="0" ixz="0" iyy="0.015686" iyz="0" izz="0.029551" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://flowerbot_description/meshes/wheel_link.STL" />
                </geometry>
                <material name="material_black"/>
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://flowerbot_description/meshes/wheel_link.STL" />
                </geometry>
            </collision>
        </link>

        <joint name="${suffix}_driving_joint" type="continuous">
            <origin xyz="0 0.007981 -0.18" rpy="${-M_PI/2} 0 0" />
            <parent link="${suffix}_steering_arm_link" />
            <child link="${suffix}_wheel_link" />
            <axis xyz="0 -1 0" />
            <safety_controller k_velocity="5" />
        </joint>
        <xacro:unless value="${wheel_type == WHEEL_TYPE_PASSIVE}">
            <driving_control joint_name="${suffix}_driving_joint"/>
        </xacro:unless>

    </xacro:macro>
</robot>